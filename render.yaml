# Render Blueprint — 定義 ApexMath 所有服務
# 文件: https://docs.render.com/blueprint-spec

services:
  # ── FastAPI 後端 ──
  - type: web
    name: apexmath-api
    runtime: docker
    dockerfilePath: ./api/Dockerfile
    dockerContext: ./api
    plan: free
    healthCheckPath: /
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: apexmath-db
          property: connectionString
        # asyncpg 需要 postgresql+asyncpg:// 前綴，Render 提供 postgres://
        # 在 app/core/config.py 中處理轉換
      - key: OPENAI_API_KEY
        sync: false  # 需在 Render Dashboard 手動設定
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: CORS_ORIGINS
        value: https://apexmath-web.onrender.com
      - key: ADMIN_USERNAME
        value: admin
      - key: ADMIN_PASSWORD
        sync: false

  # ── Vue 前端（Nginx） ──
  - type: web
    name: apexmath-web
    runtime: docker
    dockerfilePath: ./web/Dockerfile
    dockerContext: ./web
    plan: free
    envVars:
      - key: VITE_API_BASE_URL
        fromService:
          name: apexmath-api
          type: web
          envVarKey: RENDER_EXTERNAL_URL

databases:
  - name: apexmath-db
    plan: free
    databaseName: apexmath
    user: apexmath
